<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UAE Command Matrix | Strategic Overlay</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    
    <style>
        body, html { margin: 0; padding: 0; height: 100%; background-color: #050505; font-family: 'Courier New', Courier, monospace; overflow: hidden; }
        #map { height: 100vh; width: 100vw; z-index: 1; }
        
        /* Command HUD */
        #command-hud {
            position: absolute; top: 20px; right: 20px; z-index: 1000;
            background: rgba(10, 10, 10, 0.9); border: 1px solid #333;
            border-top: 4px solid #00ffcc; color: #fff; width: 340px;
            box-shadow: 0 4px 25px rgba(0,0,0,0.8); backdrop-filter: blur(10px);
            transition: transform 0.3s ease-in-out;
        }
        
        #command-hud.collapsed { transform: translateX(360px); }
        
        /* Toggle Button */
        #hud-toggle {
            position: absolute; top: 10px; left: -40px;
            background: rgba(10, 10, 10, 0.9); border: 1px solid #333;
            border-right: none; color: #00ffcc; width: 40px; height: 40px;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-size: 1.2rem;
        }

        .hud-header { padding: 15px 20px; border-bottom: 1px solid #222; }
        .hud-header h1 { font-size: 1.1rem; margin: 0; color: #00ffcc; text-transform: uppercase; letter-spacing: 1px; }
        
        .hud-section { padding: 15px 20px; border-bottom: 1px solid #222; }
        .hud-section-title { font-size: 0.85rem; color: #888; margin-bottom: 10px; text-transform: uppercase; }

        /* Custom Checkboxes */
        .formula-row { display: flex; align-items: center; margin-bottom: 12px; cursor: pointer; }
        .formula-row input[type="checkbox"] { display: none; }
        .checkbox-custom {
            width: 16px; height: 16px; border: 1px solid #555; margin-right: 12px;
            display: inline-block; position: relative; background: #000;
        }
        .formula-row input[type="checkbox"]:checked + .checkbox-custom::after {
            content: ''; position: absolute; top: 2px; left: 2px;
            width: 12px; height: 12px; background: #00ffcc; box-shadow: 0 0 8px #00ffcc;
        }
        .formula-text { font-size: 0.9rem; font-weight: bold; }
        .formula-desc { font-size: 0.75rem; color: #777; margin-left: 28px; line-height: 1.3; }

        /* Legend */
        .legend-item { font-size: 0.8rem; margin-bottom: 8px; display: flex; align-items: center; }
        .legend-color { width: 12px; height: 12px; border-radius: 50%; margin-right: 10px; }
        
        .timestamp { padding: 10px 20px; font-size: 0.75rem; color: #555; text-align: right; }
    </style>
</head>
<body>

    <div id="command-hud">
        <div id="hud-toggle" onclick="toggleHUD()">[-]</div>
        <div class="hud-header">
            <h1>Strategic Matrix</h1>
        </div>

        <div class="hud-section">
            <div class="hud-section-title">Active Threat Legend</div>
            <div class="legend-item"><div class="legend-color" style="background:#ff3333; box-shadow:0 0 8px #ff3333;"></div>Kinetic Strike Zone</div>
            <div class="legend-item"><div class="legend-color" style="background:#ff9900; box-shadow:0 0 8px #ff9900;"></div>Debris / Collateral</div>
            <div class="legend-item"><div class="legend-color" style="background:#ffcc00; box-shadow:0 0 8px #ffcc00;"></div>Airspace/Logistics Closed</div>
        </div>

        <div class="hud-section">
            <div class="hud-section-title">Strategic Formulas Blend</div>
            
            <label class="formula-row">
                <input type="checkbox" id="layer-kcr" checked onchange="toggleLayer('kcr')">
                <span class="checkbox-custom"></span>
                <span class="formula-text">KCR: Kinetic Contagion Radius</span>
            </label>
            <div class="formula-desc">Raw physical strike and debris data. Base layer for risk assessment.</div>
            <br>
            
            <label class="formula-row">
                <input type="checkbox" id="layer-scrc" onchange="toggleLayer('scrc')">
                <span class="checkbox-custom" style="border-color: #00ccff;"></span>
                <span class="formula-text" style="color: #00ccff;">SCRC: Supply Chain Reroute</span>
            </label>
            <div class="formula-desc">Visualizes safe-passage land corridors bypassing UAE airspace closures (Jebel Ali to KSA/Oman).</div>
            <br>

            <label class="formula-row">
                <input type="checkbox" id="layer-cfv" onchange="toggleLayer('cfv')">
                <span class="checkbox-custom" style="border-color: #cc00ff;"></span>
                <span class="formula-text" style="color: #cc00ff;">CFV: Capital Flight Velocity</span>
            </label>
            <div class="formula-desc">Highlights major financial hubs (DIFC, ADGM) within economic disruption radii indicating asset liquidation zones.</div>
        </div>

        <div class="timestamp">SYS.SYNC: MAR 01 2026 | OSINT ACTIVE</div>
    </div>

    <div id="map"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <script>
        // HUD Toggle Logic
        let hudOpen = true;
        function toggleHUD() {
            const hud = document.getElementById('command-hud');
            const btn = document.getElementById('hud-toggle');
            if (hudOpen) {
                hud.classList.add('collapsed');
                btn.innerText = '[+]';
                hudOpen = false;
            } else {
                hud.classList.remove('collapsed');
                btn.innerText = '[-]';
                hudOpen = true;
            }
        }

        // Initialize map
        const map = L.map('map', { zoomControl: false }).setView([24.2, 54.5], 7);
        L.control.zoom({ position: 'bottomleft' }).addTo(map);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap & CARTO', subdomains: 'abcd', maxZoom: 19
        }).addTo(map);

        // --- LAYER GROUPS ---
        const layerGroups = {
            kcr: L.layerGroup(),  // Kinetic Contagion
            scrc: L.layerGroup(), // Supply Chain Reroute
            cfv: L.layerGroup()   // Capital Flight Velocity
        };

        // 1. KCR DATA (Base Threats)
        const kineticData = [
            { coords: [24.2483, 54.5450], radius: 12000, color: '#ff3333', name: "Al-Dhafra Air Base (Strike)" },
            { coords: [25.1124, 55.1390], radius: 5000, color: '#ff9900', name: "Palm Jumeirah (Debris)" },
            { coords: [24.5295, 54.4446], radius: 8000, color: '#ff9900', name: "Saadiyat Axis (Debris)" },
            { coords: [25.2532, 55.3657], radius: 15000, color: '#ffcc00', name: "DXB Airspace Closed" }
        ];

        kineticData.forEach(d => {
            L.circle(d.coords, { color: d.color, fillColor: d.color, fillOpacity: 0.2, weight: 2 }).bindPopup(d.name).addTo(layerGroups.kcr);
            L.circleMarker(d.coords, { radius: 3, color: '#fff', fillColor: d.color, fillOpacity: 1 }).addTo(layerGroups.kcr);
        });

        // 2. SCRC DATA (Logistics Reroute Corridors)
        // Bypassing UAE completely via land to alternate safe ports
        const routeJebelToKSA = [
            [24.9857, 55.0273], // Jebel Ali Port (Origin)
            [23.9535, 52.8252], // Sila Border Crossing (UAE/KSA)
            [24.6341, 46.7265]  // Riyadh Dry Port (Destination)
        ];
        const routeToOman = [
            [25.1, 55.2], // Dubai
            [24.2, 55.7], // Al Ain border
            [23.6, 58.1]  // Muscat Port
        ];

        L.polyline(routeJebelToKSA, { color: '#00ccff', weight: 4, dashArray: '10, 10', opacity: 0.8 })
            .bindPopup('SCRC Primary: Jebel Ali to Riyadh Highway (Avoids DXB Airspace)').addTo(layerGroups.scrc);
        L.polyline(routeToOman, { color: '#00ccff', weight: 4, dashArray: '10, 10', opacity: 0.5 })
            .bindPopup('SCRC Secondary: Overland to Muscat Port (Oman)').addTo(layerGroups.scrc);
        
        // SCRC Nodes
        L.circleMarker([24.9857, 55.0273], { radius: 6, color: '#00ccff', fillOpacity: 1 }).bindPopup("Jebel Ali Port (Extraction Point)").addTo(layerGroups.scrc);
        L.circleMarker([23.9535, 52.8252], { radius: 6, color: '#00ccff', fillOpacity: 1 }).bindPopup("Sila Border Crossing").addTo(layerGroups.scrc);


        // 3. CFV DATA (Capital Flight Velocity / Financial Hubs)
        const financialHubs = [
            { coords: [25.2128, 55.2832], name: "DIFC (Dubai Intl Financial Centre)", risk: "CRITICAL - Within DXB airspace gridlock." },
            { coords: [24.5000, 54.3881], name: "ADGM (Abu Dhabi Global Market)", risk: "HIGH - Proximal to Saadiyat debris fields." }
        ];

        financialHubs.forEach(hub => {
            // Pulse effect circle for economic warning
            L.circle(hub.coords, { color: '#cc00ff', fillColor: '#cc00ff', fillOpacity: 0.15, radius: 6000, weight: 2, dashArray: '4,4' })
                .bindPopup(`<b>${hub.name}</b><br><span style="color:#cc00ff">CFV Alert: ${hub.risk}</span><br>Execute Capital Extraction Protocol.`)
                .addTo(layerGroups.cfv);
            
            // Core marker
            L.circleMarker(hub.coords, { radius: 5, color: '#cc00ff', fillOpacity: 1 })
                .bindPopup(hub.name).addTo(layerGroups.cfv);
        });

        // Initialize map with default layers
        layerGroups.kcr.addTo(map);

        // Toggle Function logic hooked to UI checkboxes
        window.toggleLayer = function(layerId) {
            const isChecked = document.getElementById(`layer-${layerId}`).checked;
            if (isChecked) {
                map.addLayer(layerGroups[layerId]);
            } else {
                map.removeLayer(layerGroups[layerId]);
            }
        };

    </script>
</body>
</html>